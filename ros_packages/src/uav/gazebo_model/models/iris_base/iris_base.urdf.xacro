<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="iris_base">

  <!-- Main quadrotor link -->
  <xacro:macro name="iris_base_macro">
    <link name="base_link">
      <inertial>
        <mass value="1.5" />
        <origin xyz="0 0 0" rpy="0 0 0" />
        <inertia ixx="0.029125" ixy="0" ixz="0" iyy="0.029125" iyz="0" izz="0.055225" />
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://uav/meshes/iris_base/iris.stl" scale="1 1 1"/>
        </geometry>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <box size="0.47 0.47 0.11" />
        </geometry>
      </collision>
    </link>

    <gazebo>
      <plugin name='rosbag' filename='libgazebo_multirotor_base_plugin.so'>
        <robotNamespace/>
        <linkName>base_link</linkName>
        <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
      </plugin>
    </gazebo>

    <link name="/imu_link">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <inertial>
        <mass value="0.015" />
        <origin xyz="0 0 0" rpy="0 0 0" />
        <inertia ixx="1e-05" ixy="0" ixz="0" iyy="1e-05" iyz="0" izz="1e-05" />
      </inertial>
    </link>
    <joint name="/imu_joint" type="revolute">
      <parent link="base_link"/>
      <child link="/imu_link"/>
      <!-- Is the next line required? Why is this joint revolute? -->
      <limit effort="30" velocity="0.0" lower="0.0" upper="0.0" />
    </joint>

    <link name="rotor_0">
      <origin xyz="0.13 -0.22 0.023" rpy="0 0 0" />
      <inertial>
        <mass value="0.005" />
        <origin xyz="0 0 0" rpy="0 0 0" />
        <inertia ixx="9.75e-07" ixy="0" ixz="0" iyy="0.000273104" iyz="0" izz="0.000274004" />
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://uav/meshes/iris_base/iris_prop_ccw.dae" scale="1 1 1"/>
        </geometry>
        <material name="blue">
          <color rgba="0 0 .8 1"/>
        </material>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <cylinder length="0.005" radius="0.128"/>
        </geometry>
      </collision>
    </link>
    <joint name="rotor_0_joint" type="revolute">
      <parent link="base_link"/>
      <child link="rotor_0_joint"/>
      <limit effort="1e+16" velocity="1e+16" />
    </joint>

  </xacro:macro>
</robot>
